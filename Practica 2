CREATE TABLE Atenciones (
    IdAtencion INT PRIMARY KEY,
    IdPaciente INT,
    NombrePaciente VARCHAR(100),
    Especialidad VARCHAR(50),
    FechaAtencion DATE,
    HoraEntrada DATETIME,
    HoraSalida DATETIME,
    Costo DECIMAL(10,2)
);
DECLARE @FechaInicio DATE = '2025-10-01';
DECLARE @FechaFin DATE = '2025-10-31';
DECLARE @EspecialidadFiltro VARCHAR(50) = 'Cardiolog√≠a';

SELECT 
    Especialidad,
    COUNT(*) AS TotalAtenciones,
    SUM(Costo) AS MontoTotal,
    MIN(FechaAtencion) AS PrimeraFecha,
    MAX(FechaAtencion) AS UltimaFecha,
    MIN(HoraEntrada) AS EntradaMasTemprana,
    MAX(HoraSalida) AS SalidaMasTardia,
    AVG(DATEDIFF(MINUTE, HoraEntrada, HoraSalida)) / 60.0 AS PromedioHorasPorAtencion,
    FORMAT(MAX(HoraSalida), 'HH:mm') AS UltimaHoraFormateada,
    FORMAT(MIN(FechaAtencion), 'dddd dd MMM yyyy') AS FechaInicioFormateada
FROM Atenciones
WHERE FechaAtencion BETWEEN @FechaInicio AND @FechaFin
  AND Especialidad = @EspecialidadFiltro
GROUP BY Especialidad
ORDER BY MontoTotal DESC;

CREATE TABLE InventarioMovimientos (
    IdMovimiento INT PRIMARY KEY,
    Producto VARCHAR(100),
    Categoria VARCHAR(50),
    Almacen VARCHAR(50),
    TipoMovimiento VARCHAR(10), -- 'Entrada' o 'Salida'
    FechaMovimiento DATE,
    HoraMovimiento DATETIME,
    Cantidad INT
);
DECLARE @FechaInicio DATE = '2025-11-01';
DECLARE @FechaFin DATE = '2025-11-05';
DECLARE @AlmacenFiltro VARCHAR(50) = 'Almacen Sur';

SELECT 
    Categoria,
    Almacen,
    TipoMovimiento,
    COUNT(*) AS TotalMovimientos,
    SUM(Cantidad) AS TotalCantidad,
    AVG(Cantidad) AS PromedioPorMovimiento,
    MIN(HoraMovimiento) AS MovimientoMasTemprano,
    MAX(HoraMovimiento) AS MovimientoMasTardio,
    FORMAT(MAX(HoraMovimiento), 'HH:mm:ss') AS UltimaHoraFormateada,
    AVG(DATEDIFF(MINUTE, CAST(FechaMovimiento AS DATETIME), HoraMovimiento)) AS PromedioMinutosDesdeMedianoche
FROM InventarioMovimientos
WHERE FechaMovimiento BETWEEN @FechaInicio AND @FechaFin
  AND Almacen = @AlmacenFiltro
GROUP BY Categoria, Almacen, TipoMovimiento
ORDER BY Categoria, TipoMovimiento, TotalCantidad DESC;
