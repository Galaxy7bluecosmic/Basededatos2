CREATE TABLE Atenciones (
    IdAtencion INT PRIMARY KEY,
    IdPaciente INT,
    NombrePaciente VARCHAR(100),
    Especialidad VARCHAR(50),
    FechaAtencion DATE,
    HoraEntrada DATETIME,
    HoraSalida DATETIME,
    Costo DECIMAL(10,2)
);
DECLARE @FechaInicio DATE = '2025-10-01';
DECLARE @FechaFin DATE = '2025-10-31';
DECLARE @EspecialidadFiltro VARCHAR(50) = 'Cardiolog√≠a';

SELECT 
    Especialidad,
    COUNT(*) AS TotalAtenciones,
    SUM(Costo) AS MontoTotal,
    MIN(FechaAtencion) AS PrimeraFecha,
    MAX(FechaAtencion) AS UltimaFecha,
    MIN(HoraEntrada) AS EntradaMasTemprana,
    MAX(HoraSalida) AS SalidaMasTardia,
    AVG(DATEDIFF(MINUTE, HoraEntrada, HoraSalida)) / 60.0 AS PromedioHorasPorAtencion,
    FORMAT(MAX(HoraSalida), 'HH:mm') AS UltimaHoraFormateada,
    FORMAT(MIN(FechaAtencion), 'dddd dd MMM yyyy') AS FechaInicioFormateada
FROM Atenciones
WHERE FechaAtencion BETWEEN @FechaInicio AND @FechaFin
  AND Especialidad = @EspecialidadFiltro
GROUP BY Especialidad
ORDER BY MontoTotal DESC;
